<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BARAH ESTATE | المعرض</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --gold: #D4AF37; --bg: #0f1215; --card: #1a1d23; --text: #fff; }
        body { font-family: 'Tajawal'; background: var(--bg); color: var(--text); margin: 0; padding-top: 80px; }
        .navbar { position: fixed; top: 0; width: 100%; z-index: 1000; background: rgba(15, 18, 21, 0.95); padding: 15px 50px; border-bottom: 1px solid rgba(212, 175, 55, 0.2); display: flex; justify-content: space-between; align-items: center; backdrop-filter: blur(10px); }
        .logo { font-size: 1.5rem; font-weight: 900; color: var(--gold); text-decoration: none; }
        .logo span { color: #fff; }
        .nav-links a { text-decoration: none; color: #aaa; margin-left: 20px; font-weight: bold; }
        .nav-links a.active { color: var(--gold); }
        .search-container { background: #15181e; padding: 30px; border-bottom: 1px solid #333; }
        .search-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; max-width: 1200px; margin: 0 auto; }
        .input-group { background: #222; border: 1px solid #444; border-radius: 10px; padding: 10px; display: flex; align-items: center; }
        .input-group i { color: var(--gold); margin-left: 10px; }
        select { background: transparent; border: none; color: #fff; width: 100%; outline: none; font-family: 'Tajawal'; font-size: 1rem; }
        select option { background: #222; }
        .btn-search { background: var(--gold); color: #000; border: none; padding: 10px; border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-search:hover { background: #b5952f; transform: scale(1.02); }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; padding: 50px; max-width: 1400px; margin: 0 auto; }
        .card { background: var(--card); border-radius: 15px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); transition: 0.4s; text-decoration: none; color: inherit; display: block; position: relative; }
        .card:hover { transform: translateY(-10px); border-color: var(--gold); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .img-wrap { height: 250px; overflow: hidden; position: relative; }
        .card-img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .card:hover .card-img { transform: scale(1.1); }
        .badge { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.8); color: var(--gold); padding: 5px 12px; border-radius: 50px; font-weight: bold; border: 1px solid var(--gold); font-size: 0.8rem; }
        .card-body { padding: 20px; }
        .price { color: var(--gold); font-size: 1.4rem; font-weight: bold; margin-bottom: 5px; }
        .title { font-size: 1.1rem; font-weight: bold; margin-bottom: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .details { color: #888; display: flex; gap: 15px; font-size: 0.9rem; border-top: 1px solid #333; padding-top: 15px; margin-top: 10px; }
        .details span { display: flex; align-items: center; gap: 5px; }
        .details i { color: var(--gold); }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body>
    <nav class="navbar">
        <a href="index.html" class="logo">BARAH <span>ESTATE</span></a>
        <div class="nav-links">
            <a href="index.html">الرئيسية</a>
            <a href="listings.html" class="active">المعرض</a>
            <a href="contact.html">تواصل معنا</a>
        </div>
    </nav>

    <div class="search-container">
        <div class="search-grid">
            <div class="input-group"><i class="fas fa-exchange-alt"></i><select id="type" onchange="updatePrice()"><option value="all">نوع العرض (الكل)</option><option value="sale">تمليك</option><option value="rent">إيجار</option></select></div>
            <div class="input-group"><i class="fas fa-building"></i><select id="unit"><option value="all">نوع العقار (الكل)</option><option value="شقة">شقة</option><option value="فيلا">فيلا</option><option value="دوبلكس">دوبلكس</option><option value="بنتهاوس">بنتهاوس</option><option value="توين هاوس">توين هاوس</option><option value="مكتب">مكتب إداري</option><option value="محل">محل تجاري</option><option value="أرض">أرض</option></select></div>
            <div class="input-group"><i class="fas fa-map-marker-alt"></i><select id="dist"><option value="all">جميع المناطق</option><option value="الحي التاسع">الحي التاسع (VIP)</option><option value="جولف سيتي">جولف سيتي</option><option value="جمعية عرابي">جمعية أحمد عرابي</option><option value="الحي الأول">الحي الأول</option><option value="الحي الثاني">الحي الثاني</option><option value="الحي الثالث">الحي الثالث</option><option value="الحي الرابع">الحي الرابع</option><option value="الحي الخامس">الحي الخامس</option><option value="الحي السادس">الحي السادس</option><option value="الحي السابع">الحي السابع</option><option value="الحي الثامن">الحي الثامن</option><option value="العبور الجديدة">العبور الجديدة</option><option value="بيت الوطن">بيت الوطن</option></select></div>
            <div class="input-group"><i class="fas fa-money-bill"></i><select id="price"><option value="all">السعر</option></select></div>
            <button class="btn-search" onclick="filter()">بحث <i class="fas fa-search"></i></button>
        </div>
    </div>

    <div class="grid" id="grid"><p style="text-align:center; grid-column:1/-1;">جاري التحميل...</p></div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyDBRcr-Np9SwYRR-cBqJDZ7FZmwk6VWLJU", authDomain: "barah-realestate-c7095.firebaseapp.com", projectId: "barah-realestate-c7095", storageBucket: "barah-realestate-c7095.firebasestorage.app", messagingSenderId: "491079034147", appId: "1:491079034147:web:c7d985a6387dfa75a8d896" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        let allData = [];

        function updatePrice() {
            const t = document.getElementById('type').value;
            const p = document.getElementById('price');
            p.innerHTML = '<option value="all">السعر (الكل)</option>';
            if(t==='rent') p.innerHTML+=`<option value="0-5000">أقل من 5000</option><option value="5000-10000">5000 - 10000</option><option value="10000-999999">أكثر من 10000</option>`;
            else if(t==='sale') p.innerHTML+=`<option value="0-1000000">أقل من مليون</option><option value="1000000-3000000">1 - 3 مليون</option><option value="3000000-999999999">أكثر من 3 مليون</option>`;
        }

        db.collection("apartments").orderBy("createdAt", "desc").onSnapshot(snap => {
            allData = [];
            snap.forEach(d => { let item=d.data(); item.id=d.id; allData.push(item); });
            render(allData);
        });

        function render(list) {
            const g = document.getElementById('grid');
            g.innerHTML = "";
            if(list.length===0) { g.innerHTML="<p style='text-align:center; grid-column:1/-1'>لا توجد نتائج</p>"; return; }
            list.forEach(u => {
                // هنا الكود بيقرأ الصورة من قاعدة البيانات تلقائياً
                const img = (u.images && u.images.length > 0) ? u.images[0] : 'https://via.placeholder.com/300';
                
                let icon = 'fas fa-building';
                if(u.unitType === 'فيلا' || u.unitType === 'توين هاوس') icon = 'fas fa-home';
                if(u.unitType === 'أرض') icon = 'fas fa-vector-square';
                
                g.innerHTML += `
                <a href="details.html?id=${u.id}" class="card">
                    <div class="img-wrap"><span class="badge">${u.type==='sale'?'تمليك':'إيجار'}</span><img src="${img}" class="card-img"></div>
                    <div class="card-body">
                        <div class="price">${u.price.toLocaleString()} EGP</div>
                        <div class="title">${u.title}</div>
                        <div class="details">
                            <span><i class="fas fa-map-marker-alt"></i> ${u.district}</span>
                            <span><i class="${icon}"></i> ${u.unitType||'وحدة'}</span>
                            <span><i class="fas fa-ruler-combined"></i> ${u.area}م</span>
                        </div>
                    </div>
                </a>`;
            });
        }

        function filter() {
            const t=document.getElementById('type').value, u=document.getElementById('unit').value, d=document.getElementById('dist').value, p=document.getElementById('price').value;
            const res = allData.filter(x => {
                let matchP = true;
                if(p!=='all') { const [min,max]=p.split('-').map(Number); matchP = x.price>=min && x.price<=max; }
                return (t==='all'||x.type===t) && (u==='all'||x.unitType===u) && (d==='all'||x.district===d) && matchP;
            });
            render(res);
        }
    </script>
    <script src="main.js"></script>
</body>
</html>