<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BARAH SYSTEM | Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- Ù†ÙØ³ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„ÙØ®Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚ --- */
        :root {
            --gold-primary: #D4AF37; --gold-glow: rgba(212, 175, 55, 0.3);
            --bg-dark: #0f1215; --card-dark: #1a1d23; --input-bg: #25282e; --text-main: #ffffff;
        }
        body { font-family: 'Tajawal'; background: var(--bg-dark); color: var(--text-main); margin: 0; padding: 0; overflow-x: hidden; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .login-brand { font-size: 3.5rem; font-weight: 900; color: var(--gold-primary); text-transform: uppercase; margin-bottom: 30px; text-shadow: 0 0 20px var(--gold-glow); }
        .login-input { width: 280px; padding: 15px; background: #111; border: 1px solid #333; border-radius: 10px; color: #fff; font-size: 1.1rem; text-align: center; margin-bottom: 10px; outline: none; transition: 0.3s; }
        .login-input:focus { border-color: var(--gold-primary); }
        .login-btn { padding: 12px 50px; background: var(--gold-primary); border: none; border-radius: 50px; font-weight: bold; cursor: pointer; font-size: 1.1rem; margin-top: 10px; }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
        #dashboardContent { display: none; padding: 40px 20px; max-width: 900px; margin: 0 auto; }
        .container { background: var(--card-dark); padding: 40px; border-radius: 20px; border: 1px solid rgba(212, 175, 55, 0.1); box-shadow: 0 20px 50px rgba(0,0,0,0.6); position: relative; }
        
        /* Ù‚Ø³Ù… Ø§Ù„Ø§Ø¯Ù…Ù† Ø§Ù„Ø®Ø§Øµ */
        #superAdminPanel { display: none; margin-bottom: 40px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .stat-card { background: #222; border: 1px solid #333; padding: 20px; border-radius: 15px; text-align: center; position: relative; overflow: hidden; }
        .stat-card.online { border-color: #28a745; box-shadow: 0 0 10px rgba(40, 167, 69, 0.2); }
        .user-avatar { width: 50px; height: 50px; background: #333; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: var(--gold-primary); }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; background: #555; position: absolute; top: 15px; right: 15px; }
        .status-dot.active { background: #28a745; box-shadow: 0 0 5px #28a745; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header { text-align: center; margin-bottom: 30px; }
        .logo { font-size: 2rem; font-weight: 800; color: var(--gold-primary); }
        .current-user-badge { background: #111; color: var(--gold-primary); padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; margin-top: 10px; display: inline-block; border: 1px solid #333; }
        
        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠØ© */
        .type-tabs { display: flex; background: #111; padding: 5px; border-radius: 50px; margin-bottom: 20px; }
        .tab-btn { flex: 1; padding: 12px; text-align: center; cursor: pointer; border-radius: 50px; color: #777; font-weight: bold; transition: 0.3s; }
        .tab-btn.active { background: var(--gold-primary); color: #000; }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³ÙŠÙƒØ±Øª */
        .visibility-tabs { display: flex; gap: 15px; margin-bottom: 30px; }
        .vis-btn { 
            flex: 1; padding: 15px; border: 1px solid #333; border-radius: 10px; 
            cursor: pointer; text-align: center; transition: 0.3s; background: #222; color: #aaa;
            display: flex; align-items: center; justify-content: center; gap: 10px; font-weight: bold;
        }
        .vis-btn.public.active { background: #004085; color: #fff; border-color: #0056b3; box-shadow: 0 0 15px rgba(0, 86, 179, 0.3); }
        .vis-btn.private.active { background: #5a0000; color: #ffcccc; border-color: #ff0000; box-shadow: 0 0 15px rgba(255, 0, 0, 0.3); }

        /* Ø§Ù„Ø­Ù‚ÙˆÙ„ */
        .input-wrapper { background: var(--input-bg); border: 1px solid #444; border-radius: 10px; display: flex; align-items: center; padding: 0 15px; margin-bottom: 15px; }
        .input-wrapper i { color: var(--gold-primary); width: 25px; }
        input, select, textarea { width: 100%; background: transparent; border: none; color: #fff; padding: 15px 10px; font-family: 'Tajawal'; font-size: 1rem; outline: none; }
        select option { background: #222; color: #fff; }

        .row-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .amenities-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .amenity-box { background: #222; border: 1px solid #333; border-radius: 10px; padding: 15px 5px; text-align: center; cursor: pointer; color: #777; transition: 0.3s; font-size: 0.9rem; }
        .amenity-box.active { border-color: var(--gold-primary); color: var(--gold-primary); background: rgba(212, 175, 55, 0.1); }
        .submit-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, var(--gold-primary), #aa8c2c); color: #000; border: none; border-radius: 10px; font-size: 1.2rem; font-weight: bold; cursor: pointer; margin-top: 25px; transition: 0.3s; }
        .submit-btn:hover { transform: scale(1.02); }

        /* Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø§Ù„Ø¹Ø§Ø¦Ù… */
        .back-floating-btn {
            position: fixed; top: 25px; right: 25px; width: 50px; height: 50px;
            background: rgba(0, 0, 0, 0.8); color: #D4AF37; border: 2px solid #D4AF37;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            text-decoration: none; z-index: 99999; font-size: 1.2rem;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3); transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        .back-floating-btn:hover { transform: scale(1.1); background: #D4AF37; color: #000; box-shadow: 0 0 25px rgba(212, 175, 55, 0.6); }
        @media (max-width: 768px) { .back-floating-btn { width: 40px; height: 40px; top: 15px; right: 15px; font-size: 1rem; } }
    </style>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body>

    <a href="javascript:history.back()" class="back-floating-btn" title="Ø±Ø¬ÙˆØ¹"><i class="fas fa-arrow-right"></i></a>

    <div id="loginOverlay">
        <div class="login-brand">BARAH SYSTEM</div>
        <p style="color:#888; margin-bottom:20px;">ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
        
        <input type="text" id="usernameInput" class="login-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (User)">
        <input type="password" id="passwordInput" class="login-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        
        <button class="login-btn" onclick="systemLogin()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        <p id="loginMsg" style="color:#ff4d4d; margin-top:15px; display:none;"></p>
    </div>

    <div id="dashboardContent">
        
        <div id="superAdminPanel">
            <h3 style="color:var(--gold-primary); text-align:center; margin-bottom:20px;">ğŸ“Š Ù„ÙˆØ­Ø© Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ† (Admin Dashboard)</h3>
            <div class="stats-grid" id="statsContainer">
                <div class="stat-card">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†...</div>
            </div>
            <hr style="border-color:#333; margin:40px 0;">
        </div>

        <div class="header">
            <div class="logo">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ­Ø¯Ø§Øª</div>
            <div id="welcomeMsg" class="current-user-badge"></div>
        </div>

        <div class="container">
            
            <div class="row-grid">
                <div class="input-wrapper" style="border-color: var(--gold-primary); background: rgba(212,175,55,0.05);">
                    <i class="fas fa-id-badge"></i>
                    <input type="text" id="marketerCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ù…Ø³ÙˆÙ‚ (ØªÙ„Ù‚Ø§Ø¦ÙŠ)" readonly>
                </div>
                <div class="input-wrapper" style="border-color: #25D366; background: rgba(37, 211, 102, 0.05);">
                    <i class="fab fa-whatsapp" style="color:#25D366"></i>
                    <input type="number" id="marketerPhone" placeholder="Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ù…Ø³ÙˆÙ‚ (Ù„Ù„ØªÙˆØ§ØµÙ„)">
                </div>
            </div>

            <div class="type-tabs">
                <div class="tab-btn active" id="tabSale" onclick="setType('sale')">ØªÙ…Ù„ÙŠÙƒ</div>
                <div class="tab-btn" id="tabRent" onclick="setType('rent')">Ø¥ÙŠØ¬Ø§Ø±</div>
            </div>

            <p style="color:#aaa; font-size:0.9rem; margin-bottom:10px;">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø±Ø¶ (Ù…Ù† Ø³ÙŠØ±Ù‰ Ø§Ù„ÙˆØ­Ø¯Ø©ØŸ):</p>
            <div class="visibility-tabs">
                <div class="vis-btn public active" id="visPublic" onclick="setVis('public')">
                    <i class="fas fa-globe"></i> Ø¹Ø§Ù… (Public)
                </div>
                <div class="vis-btn private" id="visPrivate" onclick="setVis('private')">
                    <i class="fas fa-user-secret"></i> Ø³ÙŠÙƒØ±Øª (VIP Only)
                </div>
            </div>

            <div class="input-wrapper">
                <i class="fas fa-building"></i>
                <select id="unitType">
                    <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±</option>
                    <option value="Ø´Ù‚Ø©">Ø´Ù‚Ø©</option>
                    <option value="ÙÙŠÙ„Ø§">ÙÙŠÙ„Ø§</option>
                    <option value="Ø¯ÙˆØ¨Ù„ÙƒØ³">Ø¯ÙˆØ¨Ù„ÙƒØ³</option>
                    <option value="Ø¨Ù†ØªÙ‡Ø§ÙˆØ³">Ø¨Ù†ØªÙ‡Ø§ÙˆØ³</option>
                    <option value="ØªÙˆÙŠÙ† Ù‡Ø§ÙˆØ³">ØªÙˆÙŠÙ† Ù‡Ø§ÙˆØ³</option>
                    <option value="Ù…ÙƒØªØ¨">Ù…ÙƒØªØ¨ Ø¥Ø¯Ø§Ø±ÙŠ</option>
                    <option value="Ù…Ø­Ù„">Ù…Ø­Ù„ ØªØ¬Ø§Ø±ÙŠ</option>
                    <option value="Ø£Ø±Ø¶">Ø£Ø±Ø¶</option>
                </select>
            </div>

            <div class="input-wrapper"><i class="fas fa-heading"></i><input type="text" id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†"></div>

            <div class="row-grid">
                <div class="input-wrapper"><i class="fas fa-money-bill"></i><input type="number" id="price" placeholder="Ø§Ù„Ø³Ø¹Ø±"></div>
                <div class="input-wrapper">
                    <i class="fas fa-map-marker-alt"></i>
                    <select id="district">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© / Ø§Ù„Ø­ÙŠ</option>
                        <option value="Ø§Ù„Ø­ÙŠ Ø§Ù„Ø£ÙˆÙ„">Ø§Ù„Ø­ÙŠ Ø§Ù„Ø£ÙˆÙ„</option>
                        <option value="Ø§Ù„Ø­ÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ">Ø§Ù„Ø­ÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
                        <option value="Ø§Ù„Ø­ÙŠ Ø§Ù„Ø«Ø§Ù„Ø«">Ø§Ù„Ø­ÙŠ Ø§Ù„Ø«Ø§Ù„Ø«</option>
                        <option value="Ø§Ù„Ø­ÙŠ Ø§Ù„Ø±Ø§Ø¨Ø¹">Ø§Ù„Ø­ÙŠ Ø§Ù„Ø±Ø§Ø¨Ø¹</option>
                        <option value="Ø§Ù„Ø­ÙŠ Ø§Ù„Ø®Ø§Ù…Ø³">Ø§Ù„Ø­ÙŠ Ø§Ù„Ø®Ø§Ù…Ø³</option>
                        <option value="Ø§Ù„Ø­ÙŠ Ø§Ù„Ø³Ø§Ø¯Ø³">Ø§Ù„Ø­ÙŠ Ø§Ù„Ø³Ø§Ø¯Ø³</option>
                        <option value="Ø§Ù„Ø­ÙŠ Ø§Ù„Ø³Ø§Ø¨Ø¹">Ø§Ù„Ø­ÙŠ Ø§Ù„Ø³Ø§Ø¨Ø¹</option>
                        <option value="Ø§Ù„Ø­ÙŠ Ø§Ù„Ø«Ø§Ù…Ù†">Ø§Ù„Ø­ÙŠ Ø§Ù„Ø«Ø§Ù…Ù†</option>
                        <option value="Ø§Ù„Ø­ÙŠ Ø§Ù„ØªØ§Ø³Ø¹">Ø§Ù„Ø­ÙŠ Ø§Ù„ØªØ§Ø³Ø¹ (VIP)</option>
                        <option value="Ø¬Ù…Ø¹ÙŠØ© Ø¹Ø±Ø§Ø¨ÙŠ">ğŸŒ³ Ø¬Ù…Ø¹ÙŠØ© Ø£Ø­Ù…Ø¯ Ø¹Ø±Ø§Ø¨ÙŠ</option>
                        <option value="Ø¬ÙˆÙ„Ù Ø³ÙŠØªÙŠ">â›³ Ø¬ÙˆÙ„Ù Ø³ÙŠØªÙŠ</option>
                        <option value="Ø§Ù„Ø¹Ø¨ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">Ø§Ù„Ø¹Ø¨ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</option>
                        <option value="Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ±ÙÙŠÙ‡ÙŠØ©">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ±ÙÙŠÙ‡ÙŠØ©</option>
                        <option value="Ø¥Ø³ÙƒØ§Ù† Ø¹Ø§Ø¦Ù„ÙŠ">Ø¥Ø³ÙƒØ§Ù† Ø¹Ø§Ø¦Ù„ÙŠ</option>
                        <option value="Ø¥Ø³ÙƒØ§Ù† Ø§Ù„Ø´Ø¨Ø§Ø¨">Ø¥Ø³ÙƒØ§Ù† Ø§Ù„Ø´Ø¨Ø§Ø¨</option>
                        <option value="Ø¨ÙŠØª Ø§Ù„ÙˆØ·Ù†">Ø¨ÙŠØª Ø§Ù„ÙˆØ·Ù†</option>
                    </select>
                </div>
            </div>

            <div class="row-grid">
                <div class="input-wrapper"><i class="fas fa-bed"></i><input type="number" id="rooms" placeholder="Ø§Ù„ØºØ±Ù"></div>
                <div class="input-wrapper"><i class="fas fa-bath"></i><input type="number" id="bathrooms" placeholder="Ø§Ù„Ø­Ù…Ø§Ù…Ø§Øª"></div>
            </div>
            
            <div class="row-grid">
                <div class="input-wrapper"><i class="fas fa-layer-group"></i><input type="number" id="floor" placeholder="Ø§Ù„Ø¯ÙˆØ±"></div>
                <div class="input-wrapper"><i class="fas fa-vector-square"></i><input type="number" id="area" placeholder="Ø§Ù„Ù…Ø³Ø§Ø­Ø© (Ù…Â²)"></div>
            </div>

            <div class="input-wrapper">
                <i class="fas fa-paint-roller"></i>
                <select id="finishing">
                    <option value="">Ù†ÙˆØ¹ Ø§Ù„ØªØ´Ø·ÙŠØ¨</option>
                    <option value="Ø¨Ø¯ÙˆÙ† ØªØ´Ø·ÙŠØ¨">Ø·ÙˆØ¨ Ø£Ø­Ù…Ø±</option>
                    <option value="Ù†Øµ ØªØ´Ø·ÙŠØ¨">Ù†Øµ ØªØ´Ø·ÙŠØ¨</option>
                    <option value="Ø³ÙˆØ¨Ø± Ù„ÙˆÙƒØ³">Ø³ÙˆØ¨Ø± Ù„ÙˆÙƒØ³</option>
                    <option value="Ø§Ù„ØªØ±Ø§ Ø³ÙˆØ¨Ø± Ù„ÙˆÙƒØ³">ğŸ’ Ø§Ù„ØªØ±Ø§ Ø³ÙˆØ¨Ø± Ù„ÙˆÙƒØ³</option>
                </select>
            </div>

            <p style="color:#aaa; margin-bottom:10px;">Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª:</p>
            <div class="amenities-grid">
                <div class="amenity-box" onclick="toggleAm(this)" data-val="Ø£Ø³Ø§Ù†Ø³ÙŠØ±"><i class="fas fa-elevator"></i>Ø£Ø³Ø§Ù†Ø³ÙŠØ±</div>
                <div class="amenity-box" onclick="toggleAm(this)" data-val="Ø¬Ø±Ø§Ø¬"><i class="fas fa-car"></i>Ø¬Ø±Ø§Ø¬</div>
                <div class="amenity-box" onclick="toggleAm(this)" data-val="Ø­Ø¯ÙŠÙ‚Ø©"><i class="fas fa-tree"></i>Ø­Ø¯ÙŠÙ‚Ø©</div>
                <div class="amenity-box" onclick="toggleAm(this)" data-val="Ù…Ø³Ø¨Ø­"><i class="fas fa-swimming-pool"></i>Ù…Ø³Ø¨Ø­</div>
                <div class="amenity-box" onclick="toggleAm(this)" data-val="ØºØ§Ø²"><i class="fas fa-fire"></i>ØºØ§Ø²</div>
                <div class="amenity-box" onclick="toggleAm(this)" data-val="Ø£Ù…Ù†"><i class="fas fa-user-shield"></i>Ø£Ù…Ù†</div>
            </div>

            <div class="input-wrapper" style="align-items:start;">
                <i class="fas fa-pen" style="margin-top:10px;"></i>
                <textarea id="desc" rows="4" placeholder="ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>
            </div>

            <div style="background:rgba(0,50,100,0.2); border:1px dashed #004085; padding:15px; border-radius:10px; margin-top:20px;">
                <p style="margin:0 0 5px 0; color:#58a6ff; font-size:0.9rem;">ğŸ”’ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ (GPS) - Ø³Ø±ÙŠ Ù„Ù„Ù…Ø³ÙˆÙ‚ÙŠÙ† ÙÙ‚Ø·</p>
                <input type="text" id="locationLink" placeholder="Ø¶Ø¹ Ø±Ø§Ø¨Ø· Google Maps Ù‡Ù†Ø§" style="background:#002347; border-radius:5px; color:#fff; width:95%;">
            </div>

            <div style="margin-top:20px; border:2px dashed #444; padding:20px; text-align:center; border-radius:10px;">
                <i class="fas fa-images" style="font-size:2rem; color:var(--gold-primary);"></i>
                <p>Ø§Ø®ØªØ± ØµÙˆØ± Ø§Ù„ÙˆØ­Ø¯Ø©</p>
                <input type="file" id="images" multiple>
            </div>
            
            <div class="input-wrapper" style="margin-top:15px;">
                <i class="fab fa-youtube"></i>
                <input type="text" id="youtube" placeholder="Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
            </div>

            <button class="submit-btn" onclick="uploadUnit()">Ù†Ø´Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</button>
            <p id="status" style="text-align:center; margin-top:15px; color:#fff;"></p>

        </div>
    </div>

    <script>
        // --- 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ---
        const USERS = {
            'user101': { pass: '123', name: 'Ø§Ù„Ù…Ø³ÙˆÙ‚ 101' },
            'user102': { pass: '123', name: 'Ø§Ù„Ù…Ø³ÙˆÙ‚ 102' },
            'user103': { pass: '123', name: 'Ø§Ù„Ù…Ø³ÙˆÙ‚ 103' },
            'admin':   { pass: 'AHE123', name: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù… (Admin)' }
        };

        let CURRENT_USER = null;

        function systemLogin() {
            const userIn = document.getElementById('usernameInput').value.toLowerCase().trim();
            const passIn = document.getElementById('passwordInput').value;
            const msg = document.getElementById('loginMsg');

            if (USERS[userIn] && USERS[userIn].pass === passIn) {
                CURRENT_USER = userIn;
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('dashboardContent').style.display = 'block';
                document.getElementById('welcomeMsg').innerText = `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ: ${USERS[userIn].name}`;
                
                document.getElementById('marketerCode').value = userIn.toUpperCase();

                updateUserStatus(userIn);

                if (userIn === 'admin') {
                    document.getElementById('superAdminPanel').style.display = 'block';
                    loadAdminStats();
                }

            } else {
                msg.innerText = "âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
                msg.style.display = "block";
            }
        }

        // âš ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
        const firebaseConfig = {
          apiKey: "AIzaSyDBRcr-Np9SwYRR-cBqJDZ7FZmwk6VWLJU",
          authDomain: "barah-realestate-c7095.firebaseapp.com",
          projectId: "barah-realestate-c7095",
          storageBucket: "barah-realestate-c7095.firebasestorage.app",
          messagingSenderId: "491079034147",
          appId: "1:491079034147:web:c7d985a6387dfa75a8d896"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function updateUserStatus(userId) {
            if(userId === 'admin') return;
            db.collection('users').doc(userId).set({
                lastActive: firebase.firestore.FieldValue.serverTimestamp(),
                name: USERS[userId].name
            }, { merge: true });
        }

        async function loadAdminStats() {
            const statsContainer = document.getElementById('statsContainer');
            statsContainer.innerHTML = "";
            const targets = ['user101', 'user102', 'user103'];

            for (let user of targets) {
                const userDoc = await db.collection('users').doc(user).get();
                let isOnline = false;
                if(userDoc.exists) {
                    const lastActive = userDoc.data().lastActive.toDate();
                    const now = new Date();
                    const diffMins = (now - lastActive) / 1000 / 60;
                    if(diffMins < 10) isOnline = true;
                }

                const unitsSnap = await db.collection('apartments').where('marketer', '==', user.toUpperCase()).get();
                const totalUnits = unitsSnap.size;

                statsContainer.innerHTML += `
                    <div class="stat-card ${isOnline ? 'online' : ''}">
                        <div class="status-dot ${isOnline ? 'active' : ''}"></div>
                        <div class="user-avatar"><i class="fas fa-user-tie"></i></div>
                        <h4 style="color:#fff; margin:5px 0;">${USERS[user].name}</h4>
                        <p style="color:#aaa; font-size:0.9rem;">${isOnline ? 'ğŸŸ¢ Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†' : 'ğŸ”´ ØºÙŠØ± Ù…ØªØµÙ„'}</p>
                        <hr style="border-color:#333; margin:10px 0;">
                        <div style="display:flex; justify-content:space-around;">
                            <div>
                                <h2 style="color:var(--gold-primary); margin:0;">${totalUnits}</h2>
                                <span style="font-size:0.8rem; color:#777;">ÙˆØ­Ø¯Ø© Ù…Ø³Ø¬Ù„Ø©</span>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // --- Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙˆØ§Ù„Ù…Ù†Ø·Ù‚ ---
        let currentType = 'sale';
        let visibility = 'public'; // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¹Ø§Ù…
        let selectedAmenities = [];

        function setType(t) {
            currentType = t;
            document.getElementById('tabSale').className = (t==='sale') ? 'tab-btn active' : 'tab-btn';
            document.getElementById('tabRent').className = (t==='rent') ? 'tab-btn active' : 'tab-btn';
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø³ÙŠÙƒØ±Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        function setVis(v) {
            visibility = v;
            document.getElementById('visPublic').className = v==='public'?'vis-btn public active':'vis-btn';
            document.getElementById('visPrivate').className = v==='private'?'vis-btn private active':'vis-btn';
        }

        function toggleAm(el) {
            el.classList.toggle('active');
            const val = el.getAttribute('data-val');
            if(selectedAmenities.includes(val)) selectedAmenities = selectedAmenities.filter(x => x !== val);
            else selectedAmenities.push(val);
        }

        async function uploadUnit() {
            const status = document.getElementById('status');
            const files = document.getElementById('images').files;
            
            if(!document.getElementById('title').value) { alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"); return; }
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±
            const unitType = document.getElementById('unitType').value;
            if(!unitType) { alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±"); return; }

            if(files.length === 0) { alert("ÙŠØ¬Ø¨ Ø±ÙØ¹ ØµÙˆØ±"); return; }

            status.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...";
            updateUserStatus(CURRENT_USER);

            let imageUrls = [];
            const imgbbKey = "YOUR_IMGBB_API_KEY"; // âš ï¸ Ø¶Ø¹ Ù…ÙØªØ§Ø­ ImgBB

            try {
                for(let i=0; i<files.length; i++) {
                    const formData = new FormData();
                    formData.append("image", files[i]);
                    const req = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbKey}`, {method:"POST", body:formData});
                    const res = await req.json();
                    if(res.success) imageUrls.push(res.data.url);
                }

                await db.collection("apartments").add({
                    marketer: document.getElementById('marketerCode').value,
                    marketerPhone: document.getElementById('marketerPhone').value,
                    type: currentType,
                    visibility: visibility,
                    unitType: unitType, // ğŸ”¥ Ø­ÙØ¸ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø± (Ø´Ù‚Ø©/ÙÙŠÙ„Ø§)
                    title: document.getElementById('title').value,
                    price: Number(document.getElementById('price').value),
                    district: document.getElementById('district').value,
                    rooms: document.getElementById('rooms').value,
                    bathrooms: document.getElementById('bathrooms').value,
                    floor: document.getElementById('floor').value,
                    area: document.getElementById('area').value,
                    finishing: document.getElementById('finishing').value,
                    description: document.getElementById('desc').value,
                    amenities: selectedAmenities,
                    locationPrivate: document.getElementById('locationLink').value,
                    images: imageUrls,
                    youtube: document.getElementById('youtube').value,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                status.innerText = "âœ… ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­";
                setTimeout(() => location.reload(), 2000);

            } catch(e) {
                console.error(e);
                status.innerText = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£";
            }
        }
    </script>
</body>
</html>