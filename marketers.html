<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>لوحة المسوقين | BARAH</title>
    <link rel="icon" href="logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>.admin-container{max-width:800px;margin:40px auto;padding:20px;}.form-box{background:rgba(30,41,59,0.5);padding:30px;border-radius:15px;border:1px solid var(--gold);}.ad-item{background:#1e293b;padding:15px;margin-bottom:15px;border-radius:12px;display:flex;justify-content:space-between;border:1px solid #334155;}</style>
</head>
<body>
    <div id="loginOverlay" style="position:fixed;inset:0;background:#0f172a;z-index:9999;display:flex;justify-content:center;align-items:center;"><div style="background:#1e293b;padding:40px;border-radius:15px;border:1px solid var(--gold);text-align:center;"><input type="password" id="passInput" placeholder="1234" style="text-align:center;margin-bottom:15px;"><button onclick="checkPass()" class="btn-primary" style="width:100%;">دخول</button></div></div>
    
    <div class="admin-container">
        <header style="display:flex;justify-content:space-between;margin-bottom:30px;"><h2 style="color:var(--gold);">لوحة التحكم</h2><a href="index.html" class="btn-secondary">للموقع</a></header>
        <div class="form-box">
            <h3 style="margin-bottom:20px;text-align:center;">إضافة عقار</h3>
            <form id="propertyForm">
                <input type="text" id="p-title" placeholder="العنوان" required>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;"><input type="number" id="p-price" placeholder="السعر" required><select id="p-type"><option value="sale">تمليك</option><option value="rent">إيجار</option></select></div>
                <select id="p-district"><option value="الحي الأول">الحي الأول</option><option value="الحي التاسع">الحي التاسع</option></select>
                <div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:10px;"><input type="number" id="p-area" placeholder="مساحة"><input type="number" id="p-rooms" placeholder="غرف"><input type="number" id="p-bathrooms" placeholder="حمام"><input type="number" id="p-floor" placeholder="دور"></div>
                <input type="text" id="p-youtube" placeholder="رابط يوتيوب">
                <input type="number" id="p-phone" placeholder="رقم واتساب" required>
                <input type="file" id="imageFile" style="margin-top:10px;">
                <button type="submit" class="btn-primary" style="width:100%;margin-top:15px;">نشر</button>
            </form>
        </div>
        <div id="adsList" style="margin-top:30px;"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        const app=initializeApp({apiKey:"AIzaSyDBRcr-Np9SwYRR-cBqJDZ7FZmwk6VWLJU",projectId:"barah-realestate-c7095"});
        const db=getFirestore(app);
        window.checkPass=()=>{if(document.getElementById('passInput').value==="1234"){document.getElementById('loginOverlay').style.display='none';loadAds();}else alert("خطأ");}
        async function uploadToImgBB(f){const d=new FormData();d.append("image",f);try{const r=await fetch(`https://api.imgbb.com/1/upload?key=f2f33c5aa9d3e304f8752aa2a80bd29b`,{method:"POST",body:d});const j=await r.json();return j.success?j.data.url:null;}catch{return null;}}
        document.getElementById('propertyForm').addEventListener('submit',async(e)=>{e.preventDefault();const btn=document.querySelector('button[type="submit"]');btn.innerText="جاري...";let img='logo.png';const f=document.getElementById('imageFile');if(f.files[0])img=await uploadToImgBB(f.files[0]);
        await addDoc(collection(db,"properties"),{title:document.getElementById('p-title').value,price:Number(document.getElementById('p-price').value),type:document.getElementById('p-type').value,district:document.getElementById('p-district').value,phone:document.getElementById('p-phone').value,images:[img],area:document.getElementById('p-area').value,rooms:document.getElementById('p-rooms').value,bathrooms:document.getElementById('p-bathrooms').value,floor:document.getElementById('p-floor').value,youtube:document.getElementById('p-youtube').value,createdAt:Date.now()});alert("تم!");location.reload();});
        async function loadAds(){const q=query(collection(db,"properties"),orderBy("createdAt","desc"));const s=await getDocs(q);const l=document.getElementById('adsList');l.innerHTML="";s.forEach(d=>{const a=d.data();l.innerHTML+=`<div class="ad-item"><div><h4>${a.title}</h4></div><button onclick="deleteDoc(doc(db,'properties','${d.id}')).then(()=>loadAds())" style="background:red;color:white;border:0;padding:5px 10px;border-radius:5px;">حذف</button></div>`;});}
    </script>
</body>
</html>