<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إدارة أسطول VIP | BARAH</title>
    <link rel="icon" href="logo.png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #0f172a; color: white; min-height: 100vh; }
        .admin-container { max-width: 1000px; margin: 40px auto; padding: 20px; }
        
        .fleet-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
        
        .fleet-card {
            background: rgba(30, 41, 59, 0.7); border: 1px solid #334155; border-radius: 15px; padding: 15px; 
            text-align: center; position: relative; transition: 0.3s; overflow: hidden;
        }
        .fleet-card:hover { border-color: var(--gold); transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        
        .car-img-display { width: 100%; height: 140px; object-fit: contain; margin-bottom: 15px; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.3)); }
        
        .card-header-flex { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        .brand-logo-small { width: 25px; height: 25px; object-fit: contain; }
        .car-fullname { font-size: 1.1rem; font-weight: bold; color: #fff; }

        .specs-row { display: flex; justify-content: space-around; background: rgba(0,0,0,0.2); border-radius: 8px; padding: 8px; margin-bottom: 10px; font-size: 0.85rem; color: #ccc; }
        .specs-row div { display: flex; flex-direction: column; align-items: center; gap: 2px; }
        .specs-row i { color: var(--gold); font-size: 0.9rem; }

        .delete-btn { background: #ef4444; color: white; border: none; padding: 8px; border-radius: 8px; cursor: pointer; font-size: 0.9rem; margin-top: 5px; width: 100%; transition: 0.3s; }
        .delete-btn:hover { background: #dc2626; }

        .upload-area { border: 2px dashed var(--gold); padding: 30px; text-align: center; border-radius: 15px; cursor: pointer; background: rgba(212, 175, 55, 0.05); transition: 0.3s; }
        .upload-area:hover { background: rgba(212, 175, 55, 0.1); }
        
        .filters-container { display: flex; gap: 10px; margin-top: 40px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 10px; }
        .filter-btn { 
            background: #1e293b; border: 1px solid #334155; color: white; padding: 8px 20px; border-radius: 30px; cursor: pointer; white-space: nowrap; transition: 0.3s; display: flex; align-items: center; gap: 8px;
        }
        .filter-btn:hover, .filter-btn.active { background: var(--gold); color: black; border-color: var(--gold); }
        .filter-btn img { width: 18px; height: 18px; object-fit: contain; }

        .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        input, select { background: #0f172a; border: 1px solid #334155; color: white; padding: 12px; border-radius: 8px; width: 100%; outline: none; }
        input:focus, select:focus { border-color: var(--gold); }
    </style>
</head>
<body>

    <div id="loginOverlay" style="position:fixed; inset:0; background:#0f172a; z-index:9999; display:flex; justify-content:center; align-items:center;">
        <div style="text-align:center; background:#1e293b; padding:40px; border-radius:15px; border:1px solid var(--gold); width: 90%; max-width: 400px;">
            <i class="fas fa-crown" style="font-size: 3rem; color: var(--gold); margin-bottom: 20px;"></i>
            <h2 style="color:var(--gold); margin-bottom:20px;">إدارة أسطول VIP</h2>
            <input type="password" id="passInput" placeholder="كود الدخول (1234)" style="padding: 10px; width: 100%; text-align: center; border-radius: 5px; border: 1px solid #444; background: #0f172a; color: white; margin-bottom: 15px;">
            <button onclick="checkPass()" class="btn-primary" style="width:100%;">دخول</button>
        </div>
    </div>

    <div class="admin-container">
        <header style="display:flex; justify-content:space-between; align-items:center; margin-bottom:40px; border-bottom: 1px solid #334155; padding-bottom: 20px;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <i class="fas fa-car" style="font-size: 2rem; color: var(--gold);"></i>
                <div>
                    <h1 style="font-size: 1.5rem; margin:0;">سيارات المعاينة</h1>
                    <span style="font-size: 0.8rem; color: #aaa;">إضافة وتعديل الأسطول</span>
                </div>
            </div>
            <a href="index.html" class="btn-secondary">العودة للموقع</a>
        </header>

        <div style="background: #1e293b; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); border: 1px solid #334155;">
            <h3 style="margin-bottom: 20px; color: var(--gold);"><i class="fas fa-plus-circle"></i> إضافة سيارة جديدة</h3>
            
            <div class="input-row">
                <div>
                    <label style="font-size: 0.85rem; color: #aaa; margin-bottom: 5px; display: block;">ماركة السيارة</label>
                    <select id="carBrand">
                        <option value="mercedes">Mercedes-Benz</option>
                        <option value="bmw">BMW</option>
                        <option value="audi">Audi</option>
                        <option value="rangerover">Range Rover</option>
                        <option value="porsche">Porsche</option>
                        <option value="lexus">Lexus</option>
                        <option value="toyota">Toyota</option>
                        <option value="hyundai">Hyundai</option>
                        <option value="kia">Kia</option>
                        <option value="other">أخرى</option>
                    </select>
                </div>
                <div>
                    <label style="font-size: 0.85rem; color: #aaa; margin-bottom: 5px; display: block;">موديل / اسم السيارة</label>
                    <input type="text" id="carName" placeholder="مثال: S-Class 500">
                </div>
            </div>
            
            <div class="input-row" style="grid-template-columns: 1fr 1fr 1fr;">
                <input type="number" id="carYear" placeholder="السنة (2026)">
                <input type="text" id="carColor" placeholder="اللون (أسود)">
                <input type="number" id="carSeats" placeholder="الركاب (4)">
            </div>
            
            <div class="upload-area" onclick="document.getElementById('carImage').click()">
                <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: var(--gold); margin-bottom: 10px;"></i>
                <p style="color: #aaa;">صورة السيارة (PNG خلفية شفافة)</p>
                <input type="file" id="carImage" accept="image/*" style="display: none;">
            </div>
            <p id="fileName" style="text-align: center; color: var(--gold); margin-top: 10px; font-size: 0.9rem;"></p>
            
            <button onclick="addCar()" id="addBtn" class="btn-primary" style="width: 100%; margin-top: 20px; justify-content: center;">
                <i class="fas fa-save"></i> حفظ في الأسطول
            </button>
        </div>

        <h3 style="margin-top: 50px;">الأسطول الحالي</h3>
        <div class="filters-container">
            <button class="filter-btn active" onclick="filterCars('all')">الكل</button>
            <button class="filter-btn" onclick="filterCars('mercedes')">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/90/Mercedes-Logo.svg/1024px-Mercedes-Logo.svg.png"> مرسيدس
            </button>
            <button class="filter-btn" onclick="filterCars('bmw')">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/44/BMW.svg/2048px-BMW.svg.png"> BMW
            </button>
            <button class="filter-btn" onclick="filterCars('rangerover')">
                <img src="https://1000logos.net/wp-content/uploads/2018/02/Land-Rover-logo.png"> رينج روفر
            </button>
        </div>

        <div id="fleetGrid" class="fleet-grid">
            <p style="text-align: center; grid-column: 1/-1; color: #aaa;">جاري تحميل السيارات...</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDBRcr-Np9SwYRR-cBqJDZ7FZmwk6VWLJU",
            authDomain: "barah-realestate-c7095.firebaseapp.com",
            projectId: "barah-realestate-c7095",
            storageBucket: "barah-realestate-c7095.firebasestorage.app",
            messagingSenderId: "491079034147",
            appId: "1:491079034147:web:bdfd6fa4d09b409aa8d896"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const brandLogos = {
            mercedes: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/90/Mercedes-Logo.svg/1024px-Mercedes-Logo.svg.png",
            bmw: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/44/BMW.svg/2048px-BMW.svg.png",
            audi: "https://upload.wikimedia.org/wikipedia/commons/thumb/9/92/Audi-Logo_2016.svg/2560px-Audi-Logo_2016.svg.png",
            rangerover: "https://1000logos.net/wp-content/uploads/2018/02/Land-Rover-logo.png",
            porsche: "https://cdn.icon-icons.com/icons2/2402/PNG/512/porsche_logo_icon_145784.png",
            lexus: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/57/Lexus_symbol.svg/2048px-Lexus_symbol.svg.png",
            toyota: "https://global.toyota/pages/global_toyota/mobility/toyota-brand/emblem_ogp_001.png",
            hyundai: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/44/Hyundai_Motor_Company_logo.svg/2560px-Hyundai_Motor_Company_logo.svg.png",
            kia: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/47/Kia_logo.svg/2560px-Kia_logo.svg.png",
            other: "https://cdn-icons-png.flaticon.com/512/741/741407.png"
        };

        window.checkPass = function() {
            if(document.getElementById('passInput').value === "1234") {
                document.getElementById('loginOverlay').style.display = 'none';
                loadCars();
            } else { alert("خطأ في الكود"); }
        }

        document.getElementById('carImage').addEventListener('change', function(e) {
            if(e.target.files[0]) document.getElementById('fileName').innerText = "تم اختيار: " + e.target.files[0].name;
        });

        async function uploadToImgBB(file) {
            const formData = new FormData();
            formData.append("image", file);
            const apiKey = "f2f33c5aa9d3e304f8752aa2a80bd29b"; 
            try {
                const res = await fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, { method: "POST", body: formData });
                const data = await res.json();
                return data.success ? data.data.url : null;
            } catch (error) { return null; }
        }

        window.addCar = async function() {
            const brand = document.getElementById('carBrand').value;
            const name = document.getElementById('carName').value;
            const year = document.getElementById('carYear').value;
            const color = document.getElementById('carColor').value;
            const seats = document.getElementById('carSeats').value;
            const fileInput = document.getElementById('carImage');
            const btn = document.getElementById('addBtn');

            if(!name || !year || !color || fileInput.files.length === 0) {
                alert("يرجى إكمال البيانات");
                return;
            }

            btn.disabled = true;
            btn.innerHTML = "جاري الحفظ...";

            const imageUrl = await uploadToImgBB(fileInput.files[0]);
            
            if(imageUrl) {
                await addDoc(collection(db, "vip_cars"), {
                    brand: brand,
                    name: name,
                    year: year,
                    color: color,
                    seats: seats,
                    image: imageUrl,
                    createdAt: Date.now()
                });
                alert("تم إضافة السيارة!");
                location.reload();
            } else {
                alert("فشل رفع الصورة");
                btn.disabled = false;
                btn.innerHTML = "حاول مرة أخرى";
            }
        }

        let allCars = [];

        async function loadCars() {
            const grid = document.getElementById('fleetGrid');
            const q = query(collection(db, "vip_cars"), orderBy("createdAt", "desc"));
            const snap = await getDocs(q);
            
            allCars = [];
            snap.forEach(doc => {
                let car = doc.data();
                car.id = doc.id;
                allCars.push(car);
            });

            renderCars(allCars);
        }

        function renderCars(cars) {
            const grid = document.getElementById('fleetGrid');
            grid.innerHTML = "";
            
            if(cars.length === 0) {
                grid.innerHTML = '<p style="color:#aaa; grid-column:1/-1; text-align:center;">لا توجد سيارات.</p>';
                return;
            }

            cars.forEach(car => {
                const logoUrl = brandLogos[car.brand] || brandLogos['other'];

                grid.innerHTML += `
                    <div class="fleet-card">
                        <div class="card-header-flex">
                            <img src="${logoUrl}" class="brand-logo-small">
                            <span class="car-fullname">${car.name}</span>
                        </div>
                        
                        <img src="${car.image}" class="car-img-display" alt="${car.name}">
                        
                        <div class="specs-row">
                            <div><i class="fas fa-calendar"></i> ${car.year}</div>
                            <div style="width:1px; background:#444;"></div>
                            <div><i class="fas fa-palette"></i> ${car.color}</div>
                            <div style="width:1px; background:#444;"></div>
                            <div><i class="fas fa-chair"></i> ${car.seats}</div>
                        </div>

                        <button onclick="deleteCar('${car.id}')" class="delete-btn"><i class="fas fa-trash"></i> حذف</button>
                    </div>
                `;
            });
        }

        window.filterCars = function(brandType) {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');

            if(brandType === 'all') {
                renderCars(allCars);
            } else {
                const filtered = allCars.filter(car => car.brand === brandType);
                renderCars(filtered);
            }
        }

        window.deleteCar = async function(id) {
            if(confirm("حذف السيارة؟")) {
                await deleteDoc(doc(db, "vip_cars", id));
                loadCars();
            }
        }
    </script>
</body>
</html>